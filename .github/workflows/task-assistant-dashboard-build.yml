---
name: Task Assistant â€¢ Dashboard Build

# yamllint disable rule:truthy
on:
  workflow_dispatch:
  schedule:
    - cron: "15 * * * *"   # hourly, offset from emit jobs

permissions:
  contents: write   # telemetry repo only

jobs:
  build_dashboards:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout telemetry repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Ensure dashboard directories exist
        run: |
          mkdir -p telemetry/v1/dashboards

      - name: Build dashboards from telemetry
        run: node scripts/build-dashboards.js
        env:
          TELEMETRY_ROOT: telemetry/v1/repos
          DASHBOARD_ROOT: telemetry/v1/dashboards

      - name: Commit dashboard updates
        run: |
          git config user.name "task-assistant-bot"
          git config user.email "actions@github.com"
          git add telemetry/v1/dashboards
          git commit -m "telemetry(v1): update dashboards" || echo "No changes"
          git push || echo "No changes"
